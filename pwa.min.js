(function(){const pwaStorage={isfastmode:function(){return(function(){var isfastmode=1;try{localStorage.setItem('checkfastmode',1);isfastmode=0}catch(e){}return isfastmode})()},set:function(key,value){if(this.isfastmode())return'';localStorage.setItem(key,JSON.stringify(value))},get:function(key){if(this.isfastmode())return'';return JSON.parse(localStorage.getItem(key))},remove:function(key){if(this.isfastmode())return'';localStorage.removeItem(key)}};var isIntallPwa=pwaStorage.get("isIntallPwa");if(location.href.indexOf("pwa=1")!=-1){window.isPWA=1}else if(location.href.indexOf("pwa=0")!=-1){window.isPWA=0}if(window.isPWA){pwaWorkFn();console.log("注册用户")}else{if(isIntallPwa){pwaWorkFn(1);console.log("注销用户")}else{console.log("没执行pwa")}}function pwaWorkFn(isOff){if(window.isPWA&&window.SIMA&&window.SIMA.suda_count){window.SIMA.suda_count({'type':'techPwa','name':'techPwaCount','title':'科技首页pwa灰度用户','index':0})};const sendMessageToSW=msg=>new Promise((resolve,reject)=>{const messageChannel=new MessageChannel();messageChannel.port1.onmessage=event=>{};navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage(msg,[messageChannel.port2])});if('serviceWorker'in navigator){var isCaln=true;navigator.serviceWorker.register('./service_worker.d.js?pwa='+window.isPWA).then(function(registration){if(window.SIMA&&window.SIMA.suda_count){window.SIMA.suda_count({'type':'techPwa','name':'techPwaReg','title':'科技首页pwa注册上报日志','index':0})};pwaStorage.set("isIntallPwa",1);console.log('pwa注册成功');if(isOff){registration.unregister().then(function(boolean){if(boolean){if(window.SIMA&&window.SIMA.suda_count){window.SIMA.suda_count({'type':'techPwa','name':'techPwaUnreg','title':'科技首页pwa注销上报日志','index':0})};pwaStorage.set("isIntallPwa",0);console.log("pwa注销成功")}})}}).then(()=>sendMessageToSW("isIntallPwa")).catch(function(err){console.log("pwa错误提示",err)})}navigator.serviceWorker.addEventListener('message',function(e){console.log(e.data,"来自pwa的问候")})}})()